2024/7/7
上次第三集还有一点没看完，收个尾
SJW要通过实验测试决定；不同设备误差过大SJW也无能为力
波特率的计算（bps）即（1/一个数据位）的时长（每秒传多少个bit），对于can来说，也就是1/（Tss+Tpts+Tpbs1+Tpbs2）

第四章：总线的资源分配规则（即多设备同时发送的问题）
1）先占先得；2）非破坏性仲裁（同时开始的情况）
1）：任何设备检测到连续11个隐性电平（1位ACK界定，7位EOF,3位帧间隔或者是错误界定8+间隔3），即认为总线空闲，只有空闲时设备才能发送数据帧或者遥控帧
2）：CAN总线协议根据ID号进行仲裁，ID小的获胜，大的转入接收状态，等待下一次总线空闲；
实现非破坏性仲裁的两个要求：线与特性和回读机制
数据位从前往后依次比较，发送和回读的数据出现差异且数据位为1的设备仲裁失利
插入的填充位不会影响仲裁结果
数据帧和遥控帧的ID一样，数据帧高于遥控帧（仲裁段RTR数据帧0覆盖遥控帧1）（符合逻辑，既然要的数据来了，那就不请求了），ID不一样直接正常仲裁
相同ID的数据帧或者遥控帧不能同时出现，会无法仲裁
标准格式11位ID号和扩展格式29位ID号高11位一样时，标准格式的优先级高于扩展格式
因为扩展发完11位发的是SRR=1，而标准发完11位给的RTR=0，覆盖了1，仲裁胜出
如果时扩展数据帧和标准遥控帧相遇，前11位相同，且SRR=RTR=1,标准遥控帧仲裁结束，但是扩展数据帧继续仲裁，第十三位是IDE，而标准格式的IDE=0,标准遥控帧获胜

第五章：错误处理
错误类型：位错误、填充错误、CRC错误、格式错误、应答错误
位错误：发的位和回读的位不一样（排除仲裁和应答位），检查范围是数据帧全部、遥控帧全部、错误帧和过载帧，检测单元是发送单元和接受单元
填充错误：在需要位填充的段内，连续监测到6个连续相同的电平。检查范围是数据帧和遥控帧除了CRC界定符、ACK槽、ACK界定符和EOF这些固定格式不进行填充以外的全部，同样检测发送和接受单元
CRC错误：接收到的数据算出的CRC和接收到的CRC序列不一样，检测范围无需多言，检测单位是接收单位
格式错误：检测出固定格式位电平出现错误，检测范围是数据帧和遥控帧的CRC、ACK界定符（1），EOF（7个1）以及错误、过载界定符（1）
ACK错误：发送方发了帧，但是应答方没回应（ACK没动静），检查数据帧和遥控帧的ACK槽，检测发送单元
当总线上的发送或者接收单元检测到错误，就会发出错误帧（错误通知）破坏数据，终止传输

错误状态（主动错误-->被动错误-->总线关闭），由TEC和REC决定（trans/receive error counter）
主动状态TEC或者REC大于127进入被动，两个都小于就转回来，被动状态TEC大于255就转入总线关闭状态（只是发有问题可以不用关掉总线接着收）
总线关闭到128次连续十一个位的1，TEC,REC清零，设备回归主动

第五集也看完了，江协目前只更新了理论知识，但是实验没有做，我去看看中科大那个https://www.bilibili.com/video/BV1HY411D7Ar/?spm_id_from=333.788.top_right_bar_window_custom_collection.content.click&vd_source=5ceb8658428644cc93d414930a0bb7e8

可能还要看下CUBE的基础操作，又忘了
